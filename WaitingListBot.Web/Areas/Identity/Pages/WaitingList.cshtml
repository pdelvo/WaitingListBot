@page "{id}"
@model WaitingListBot.Web.Areas.Identity.Pages.WaitingListModel
@{
    if (Model.Minimal)
    {
        Layout = "/Pages/Shared/_Minimal.cshtml";
    }
    ViewData["Title"] = "Waiting List";
}
@if (!Model.Minimal)
{
    <h1 class="my-0">Waiting List</h1>
}

<ul id="userList" class="list-inline">
    <li v-for="(user, index) in users">
        <span class="lead">{{increment(index)}}. {{user.name}} <span class="sub" v-if="user.isSub">(Sub)</span> <span v-if="user.counter > 0">(Played {{user.counter}} time<span v-if="user.counter > 1">s</span>)</span></span>
    </li>
</ul>
<script type="text/javascript">
        const app = Vue.createApp({
            data() {
                return {
                    users: []
                }
            },
            methods: {
               async reloadData() {
                    var res = await fetch('/Identity/WaitingList/@(Model.Id)?handler=data', {
                        method: 'get',
                        headers: {
                            'content-type': 'application/json'
                        }
                    })
                    // a non-200 response code
                    if (!res.ok) {
                        // create error instance with HTTP status text
                        const error = new Error(res.statusText);
                        error.json = res.json;
                        throw error;
                    }
                    this.users = await res.json();
                },
                increment(index) {
                    return index + 1;
                }
            }
        });
        const vm = app.mount('#userList');
        vm.reloadData();
        window.setInterval(vm.reloadData, 5000);
</script>